# ViewBot 알고리즘 분석: 실제 시청자 수가 증가하지 않는 이유

## 1. 현재 앱이 하는 일 (요청 전송)

```
[사용자] viewtest-pi.vercel.app 에서 "시작" 클릭
    ↓
[앱] 입력한 URL(예: YouTube 라이브)으로 N번 요청 전송
    ↓
sendOne(index) → fetch(YouTube_URL, { method: 'GET', mode: 'no-cors', credentials: 'omit' })
    ↓
브라우저가 YouTube 서버에 GET 요청만 보냄 (페이지 HTML 받는 수준)
```

- **실제 동작:** 같은 브라우저(탭) 하나에서 `fetch(라이브_URL)` 를 여러 번 호출.
- **하지 않는 것:** 새 탭/창 열기, YouTube 페이지에서 JS 실행, 플레이어 로드, 재생 이벤트 전송.

---

## 2. 요청 한 번의 의미 (fetch ≠ 시청 1명)

| 단계 | 현재 구현 | YouTube가 “시청”으로 인식하는 조건 |
|------|-----------|-------------------------------------|
| 1 | `GET /watch?v=xxx` 전송 | 페이지 요청 ✅ |
| 2 | 응답 본문 미사용 (`no-cors`) | — |
| 3 | **페이지 JS 미실행** (HTML만 수신) | **watch 페이지 JS 실행** → 플레이어 로드 |
| 4 | **플레이어 미로드** | **플레이어 로드 + 스트림 요청** |
| 5 | **재생/시청 이벤트 없음** | **재생 상태·하트비트 등 백엔드 전송** |

- **현재:** 같은 브라우저에서 YouTube watch URL로 **GET 요청만 반복**.
- **필요:** **실제 시청(플레이어 + 이벤트)** 가 있어야 동시 시청자 수에 반영됨.

---

## 3. YouTube 동시 시청자 집계 방식

- **페이지 조회 수가 아님.** GET 요청 횟수만으로는 세지 않음.
- **집계에 가까운 동작:**
  1. watch 페이지 로드
  2. 플레이어 로드
  3. 라이브 스트림/플레이어가 서버와 연결
  4. 주기적 "시청 중" 신호(하트비트)를 보내는 **세션** → 1명으로 카운트

→ `fetch(url)` 반복만으로는 **플레이어·시청 이벤트가 없어** 카운트에 포함되지 않음.

---

## 4. 실제 증가가 안 되는 이유 (알고리즘 관점)

| 원인 | 설명 |
|------|------|
| **요청 방식** | `fetch(..., no-cors)` = GET 1회로 HTML 수신 수준. 페이지 JS는 실행·렌더링되지 않음. |
| **백엔드 조건** | 시청자 1명 = **플레이어 세션 + 하트비트** 필요. 현재 방식은 이를 생성하지 않음. |
| **단일 클라이언트** | 모든 요청이 viewtest를 보는 **동일 브라우저**에서 발생. IP·쿠키·세션 기준 1명 또는 봇으로 처리될 수 있음. |
| **봇 탐지** | 동일 URL로 GET만 다량 전송하는 패턴은 자동화/봇으로 분류되기 쉬우며, 시청자 수에 반영되지 않거나 제한됨. |

---

## 5. 현재 알고리즘 흐름도

```
[시작]
  → URL, 요청 수 N, 최소/최대 대기(초) 읽기
  → videoId 있으면: /api/youtube-viewers 로 “시작 시청자 수” 조회 (표시용)
  → i = 0

[반복] (i = 0 .. N-1)
  → sendOne(i):
      fetch(URL, { method: 'GET', mode: 'no-cors', credentials: 'omit' })
      성공 시: "요청 #(i+1) 전송됨", 완료 수 +1
      실패 시: "요청 #(i+1) 실패", 실패 수 +1
  → randomDelay(최소 대기, 최대 대기) 후 다음 sendOne(i+1)

[15초마다] (YouTube URL인 경우)
  → /api/youtube-viewers 로 “현재 시청자 수” 다시 조회
  → UI: 시작 시청자, 현재 시청자, 변화량 갱신

[종료]
  → N번 다 보내면 "완료: 전송 O개, 실패 X개"
```

- **“전송”** = 위의 **fetch(URL)** 한 번.  
- **“실제 증가”** = YouTube가 **플레이어·하트비트 기반으로 1명 추가**하는 것.  
→ 현재 구조에서는 전송 횟수와 “실제 시청자 증가”가 **연결되지 않음.**

---

## 6. 결론

- **왜 증가가 안 되는가**  
  구현은 **"URL로 GET만 반복 전송"**하는 수준이며, YouTube가 동시 시청자로 세는 조건(**플레이어 로드 + 시청 중 이벤트**)을 만족하지 않기 때문이다.

- **기술적으로 증가시키려면**  
  실제 브라우저에서 watch 페이지를 열고, 플레이어가 로드·재생되며 YouTube 내부 API/이벤트가 발생해야 함.  
  → **Puppeteer/Playwright** 등으로 페이지 열기 및 (가능 시) 짧은 재생까지 수행하는 수준이 필요.  
  → 해당 방식은 리소스·정책·이용약관 이슈가 있으므로 **교육/시뮬레이션 목적**으로만 이해할 것.

이 문서는 **"왜 실제 시청자 수가 증가하지 않는지"**를 알고리즘·동작 기준으로 정리한 것이다.
